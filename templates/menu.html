<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sayfa ƒ∞√ßi Sekmeler</title>
    <style>
        /* Sekme ba≈ülƒ±klarƒ± */
        .tab {
            display: inline-block;
            padding: 10px 20px;
            background-color: #ddd;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }

        /* Aktif sekme ba≈ülƒ±ƒüƒ± */
        .tab.active {
            background-color: #333;
            color: white;
        }

        /* Sekme i√ßerikleri */
        .tab-content {
            display: none;
            padding: 20px;
            border: 0px solid #ddd;
            border-top: none;
        }

        /* Aktif sekme i√ßeriƒüi */
        .tab-content.active {
            display: block;
        }

        /* Logo ve Ba≈ülƒ±k */
        .header {
            display: flex;
            align-items: center; /* Dikeyde ortalama */
            justify-content: flex-start; /* Sol hizalama */
            padding: 10px 20px;
            background-color: #f8f8f8;
            border-bottom: 1px solid #ddd;
            position: relative;
        }

        .logo {
            max-width: 300px;
            height: auto;
            margin-right: 20px; /* Logo ile kullanƒ±cƒ± bilgisi arasƒ±na bo≈üluk ekleyebiliriz */
        }

        .user-info {
            display: flex;
            flex-direction: column; /* Yatay yerine dikey sƒ±ralar */
            gap: 0; /* Aradaki bo≈üluƒüu sƒ±fƒ±rla */
            margin: 0; /* Margin sƒ±fƒ±rlandƒ± */
        }

        .user-info h1, .user-info p {
            margin: 0; /* Burada da margin sƒ±fƒ±rlandƒ± */
            padding: 0; /* Padding sƒ±fƒ±rlandƒ± */
        }

        .header-button {
            margin-left: 20px; /* Buton ile kullanƒ±cƒ± bilgisinin arasƒ±na bo≈üluk ekleyebiliriz */
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .header-button:hover {
            background-color: #0056b3;
        }

        .logout {
            position: absolute;  /* Sabit pozisyon */
            top: 10px;        /* Ekranƒ±n √ºst√ºnden 10px mesafe */
            right: 10px;      /* Ekranƒ±n saƒüƒ±ndan 10px mesafe */
            text-decoration: none;
            background-color: #f44336;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 10000;    /* Diƒüer √∂ƒüelerin √∂n√ºnde g√∂r√ºns√ºn */
        }

        /* Sabit Tab Bar - Sekme ba≈ülƒ±klarƒ± altta */
        .tab-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #007BFF;
            padding: 10px 0;
            z-index: 1000;
        }

        /* Sayfa i√ßeriƒüi, sekme ba≈ülƒ±klarƒ± ile √ßakƒ±≈ümasƒ±n diye alt tarafta bir bo≈üluk bƒ±rak */
        .content {
            padding-bottom: 70px; /* Alt kƒ±sƒ±mdaki sabit sekme √ßubuƒüu i√ßin bo≈üluk */
        }

        /* M√º≈üteri Penceresi */
        .modal {
            display: none; /* Ba≈ülangƒ±√ßta gizli */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Yarƒ± ≈üeffaf arka plan */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            width: 1200px;
        }

        .modal input {
            width: 30%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .modal button {
            background-color: #007BFF;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .modal button:hover {
            background-color: #0056b3;
        }

        table {
            width: 50%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }
        .scrollable-table {
            max-height: 820px; /* Tablonun maksimum y√ºksekliƒüi */
            overflow-y: auto; /* Yalnƒ±zca dikey kaydƒ±rma */
            border: 1px solid #ddd; /* √áer√ßeve ekleyin */
        }

        .scrollable-table table {
            width: 100%; /* Tabloyu kapsayƒ±cƒ±ya yay */
            border-collapse: collapse; /* √áer√ßeveleri birle≈ütir */
        }

        .scrollable-table th {
            position: sticky; /* Sabit pozisyon */
            top: 0; /* Tablo ba≈ülƒ±ƒüƒ± yukarƒ±da sabitlenir */
            background-color: #f2f2f2; /* Arka plan rengi */
            z-index: 1; /* Ba≈ülƒ±ƒüƒ± diƒüer elemanlarƒ±n √ºst√ºnde tut */
            border: 1px solid #ddd; /* Ba≈ülƒ±k h√ºcre √ßer√ßevesi */
            padding: 8px; /* ƒ∞√ßerik aralƒ±ƒüƒ± */
            text-align: center; /* Ortala */
        }
    </style>
</head>
<body>

 <!-- √áƒ±kƒ±≈ü Butonu -->
 <a href="/logout" class="logout">√áƒ±kƒ±≈ü Yap</a>

 <!-- Logo ve Kullanƒ±cƒ± Bilgileri -->
 <div class="header">
     <img src="/static/images/logo.png" alt="Logo" class="logo">
     <div class="user-info" id="{{ user_id }}">
        <h1 id="username">User Name: {{ user }}</h1>
         <!--<h1>User Name: {{ user }}</h1>-->
         <!--<p id="largestFile">Quotation Number: {{ largest_file }}</p>-->
         <p id="largestFile">{{ largest_file }}</p>
     </div>
     <button class="header-button" onclick="openModal()">M√º≈üteri Bilgileri</button> <!-- Yeni Buton -->
     <div id="selectedCustomer" style="margin-left: 20px; font-size: 14px;">
         <!-- Se√ßilen m√º≈üteri bilgileri burada g√∂r√ºnecek -->
     </div>
 </div>

 <!-- ƒ∞√ßerik -->
 <div class="content">

        <!-- Unite Tab ƒ∞√ßeriƒüi -->

        <!-- Unite Tab ƒ∞√ßeriƒüi -->
        <div id="tab_unite" class="tab-content">
            <h2>Unite Page</h2>
            <!--<p>Bu, Unite sekmesinin i√ßeriƒüidir.</p>-->
            <!-- 40 Satƒ±r ve 43 Kolonlu Tablo -->

            <!--<button id="updateWidthButton">Update Width</button>-->

            <form method="POST">
                <div class="scrollable-table">
                <table>
                    <thead>
                        <tr>
                            <th colspan="6"></th>
                            <th colspan="2">Top Shelf1</th>
                            <th colspan="2">Top Shelf2</th>
                            <th colspan="2">Top Shelf3</th>
                            <th colspan="3">Back Panel 40</th>
                            <th colspan="3">Back Panel 30</th>
                            <th colspan="3">Back Panel 20</th>
                            <th colspan="3">Back Panel 10</th>
                            <th colspan="1">Color</th>
                            <th colspan="2">Shelves</th>
                            <th colspan="2">Back Panels</th>
                            <th colspan="2">Post, Baseleg</th>
                            <th colspan="2">Extras</th>
                            <th colspan="2">Risers</th>
                            <th colspan="2">Wire Shelves</th>
                            <th colspan="2">Baskets</th>
                            <th colspan="2">Hooks</th>
                            <th colspan="2">Counter Standart</th>
                            <th colspan="2">Counter High</th>
                        </tr>
                        <tr>
                            <th>Sira</th>
                            <th>Unit Piece</th>
                            <th>Unit Type</th>
                            <th>Height</th>
                            <th>Width</th>
                            <th>Base Shelf</th>
                            <th>Qty</th>
                            <th>Shelf Size</th>
                            <th>Qty</th>
                            <th>Shelf Size</th>
                            <th>Qty</th>
                            <th>Shelf Size</th>
                            <th>BP 40</th>
                            <th>Plane 40</th>
                            <th>Perf 40</th>
                            <th>BP 30</th>
                            <th>Plane 30</th>
                            <th>Perf 30</th>
                            <th>BP 20</th>
                            <th>Plane 20</th>
                            <th>Perf 20</th>
                            <th>BP 10</th>
                            <th>Plane 10</th>
                            <th>Perf 10</th>
                            <th>Color</th>
                            <th>Qty</th>
                            <th>Shelf</th>
                            <th>Qty</th>
                            <th>Back Panel</th>
                            <th>Qty</th>
                            <th>Item</th>
                            <th>Qty</th>
                            <th>Extras</th>
                            <th>Qty</th>
                            <th>Risers</th>
                            <th>Qty</th>
                            <th>Wire Shelf</th>
                            <th>Qty</th>
                            <th>Baskets</th>
                            <th>Qty</th>
                            <th>Hooks</th>
                            <th>Qty</th>
                            <th>Counter Standart</th>
                            <th>Qty</th>
                            <th>Counter High</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in range(40) %}
                        <tr data-row-index="{{ i }}">
                            <td class="row-number">{{ i + 1 }}</td>
                            <td>
                                <select name="option1_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox1'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option2_{{ i }}" class="trigger-select">
                                    <option value=""></option>
                                    {% for option in options['combobox2'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option3_{{ i }}"class="base-select">
                                    <option value=""></option>
                                    {% for option in options['combobox3'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option4_{{ i }}" >
                                    <option value=""></option>
                                    {% for option in options['combobox4'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option5_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox5'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option6_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox6'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option7_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox7'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option8_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox8'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option9_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox9'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option10_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox10'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option11_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox11'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <label class="value-label" id="value1_{{ i }}"></label>
                            </td>
                            <td>
                                <select name="option13_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox13'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option14_{{ i }}" class="bp-select">
                                    <option value=""></option>
                                    {% for option in options['combobox14'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <label class="value-label" id="value2_{{ i }}"></label>
                            </td>
                            <td>
                                <select name="option16_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox16'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option17_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox17'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <label class="value-label" id="value3_{{ i }}"></label>
                            </td>
                            <td>
                                <select name="option19_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox19'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option20_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox20'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <label class="value-label" id="value4_{{ i }}"></label>
                            </td>
                            <td>
                                <select name="option22_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox22'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="option23_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox23'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            


                             <td>
                                <select name="option24_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox24'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>

                            <td>
                                <!-- Label yerine text box (input) ekliyoruz -->
                                <input type="text" class="value-input" style="width: 30px;"  onkeypress="return isNumberKey(event)" /> 
                            </td>
                            <td>
                                <select name="option26_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox26'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <input type="text" class="value-input" style="width: 30px;"  onkeypress="return isNumberKey(event)" /> 
                            </td>
                            <td>
                                <select name="option28_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox28'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <input type="text" class="value-input" style="width: 30px;"  onkeypress="return isNumberKey(event)" /> 
                            </td>
                            <td>
                                <select name="option30_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox30'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <input type="text" class="value-input" style="width: 30px;"  onkeypress="return isNumberKey(event)" /> 
                            </td>
                            <td>
                                <select name="option32_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox32'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <input type="text" class="value-input" style="width: 30px;"  onkeypress="return isNumberKey(event)" /> 
                            </td>
                            <td>
                                <select name="option34_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox34'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <input type="text" class="value-input" style="width: 30px;"  onkeypress="return isNumberKey(event)" /> 
                            </td>
                            <td>
                                <select name="option36_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox36'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <input type="text" class="value-input" style="width: 30px;"  onkeypress="return isNumberKey(event)" /> 
                            </td>
                            <td>
                                <select name="option38_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox38'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <input type="text" class="value-input" style="width: 30px;"  onkeypress="return isNumberKey(event)" /> 
                            </td>
                            <td>
                                <select name="option40_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox40'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <input type="text" class="value-input" style="width: 30px;"  onkeypress="return isNumberKey(event)" /> 
                            </td>
                            <td>
                                <select name="option42_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox42'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <input type="text" class="value-input" style="width: 30px;"  onkeypress="return isNumberKey(event)" /> 
                            </td>
                            <td>
                                <select name="option44_{{ i }}">
                                    <option value=""></option>
                                    {% for option in options['combobox44'] %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                </div>
            </form>
        </div>

        <!-- Diƒüer Tab ƒ∞√ßeriƒüi (√ñrnek: Refrigeration) -->
        <div id="tab_refrigeration" class="tab-content">
            <h2>Refrigeration</h2>
            <p>Bu, Refrigeration sekmesinin i√ßeriƒüidir.</p>
        </div>

        <div id="tab_add_item" class="tab-content">
            <h2>ADD ITEM</h2>
            <!--<p>Bu, add item sekmesinin i√ßeriƒüidir.</p>-->
            <!--<table border="1" style="width: 100%; text-align: center;">-->
                <table border="1" style="text-align: center;">
                <thead>
                    <tr>
                        <th style="width: 200px;">Item Name</th>
                        <th style="width: 30px;">Qty</th>
                        <th style="width: 30px;">Price</th>
                        <th style="width: 30px;">After Disc.</th>
                        <th style="width: 60px;">Depo Code</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 20 satƒ±r olu≈üturuluyor -->
                    <!-- Her satƒ±rda 5 s√ºtun -->
                    <!-- 2., 3., ve 4. s√ºtunlar i√ßin yalnƒ±zca rakam giri≈üi -->
                    <!-- HTML5 input type="number" kullanƒ±larak saƒülanƒ±r -->
                    <!-- Satƒ±rlar dinamik olarak √ßoƒüaltƒ±labilir -->
                    <script>
                        //<input type="text" class="value-input" style="width: 30px;"  onkeypress="return isNumberKey(event)" /> 
                        //<td><input type="number" style="width: 100%;"></td>
                        //<td><input type="number" step="0.01" style="width: 100%;"></td>
                        // 20 satƒ±r ve 5 s√ºtun ekleyen dinamik JavaScript kodu
                        for (let i = 0; i < 20; i++) {
                            document.write(`<tr>
                                <td><input type="text" style="width: 100%;"></td>
                                <td><input type="text" style="width: 100%;"  onkeypress="return isNumberKey(event)" ></td> 
                                <td><input type="text" style="width: 100%;"  onkeypress="return isNumberKey(event)" ></td> 
                                <td><input type="text" style="width: 100%;"  onkeypress="return isNumberKey(event)" ></td>
                                <td><input type="text" style="width: 100%;"></td>
                            </tr>`);
                        }
                    </script>
                </tbody>
            </table>
        </div>
        
        <div id="tab_proforma" class="tab-content active">
            <!-- <h2>Proforma</h2>-->
            <h2 id="tableHeader">Quote list: Y√ºkleniyor...</h2>
            <p>Bu, PROFORMA.</p>
            <!-- <button id="updateWidthBtn">Make Proforma</button>-->

            <button id="updateWidthBtn" onclick="queueManager(getUserName())">
                Make Proforma
            </button>


            <p id="statusMessage"></p>
        
            <!-- Quote List Table -->
            <table id="quoteListTable" border="1" style="margin-top: 20px; width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th>USER_ID</th>
                        <th>ITEM_ID</th>
                        <th>ITEM_NAME</th>
                        <th>ADET</th>
                        <th>UNIT_TYPE</th>
                        <th>SIRA</th>
                        <th>PRICE</th>
                        <th>D.PRICE</th>
                        <th>AMOUNTH</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Veri buraya y√ºklenecek -->
                </tbody>
            </table>
        </div>

        <div id="tab_goruntule" class="tab-content">
            <h1>Database Content</h1>
        
            {% if data %}
                {% for table_name, table_data in data.items() %}
                    <h2>{{ table_name }}</h2>  <!-- Tablo adƒ± -->
                    <table border="1">
                        <thead>
                            <tr>
                                {% for column in table_data.columns %}
                                    <th>{{ column }}</th>  <!-- S√ºtun isimleri -->
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in table_data.rows %}
                                <tr>
                                    {% for cell in row %}
                                        <td>{{ cell }}</td>  <!-- Her h√ºcrenin deƒüeri -->
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% endfor %}
            {% else %}
                <p>No data available.</p>
            {% endif %}
        </div>


        <!-- Diƒüer i√ßerikler buraya eklenebilir -->
    </div>

    <div class="modal" id="customerModal">
        <div class="modal-content">
            <h2>M√º≈üteri Bilgileri</h2>
            <input type="text" id="searchBox" placeholder="M√º≈üteri Arama..." onkeyup="searchCustomer()">
            <table id="customerTable">
                <thead>
                    <tr>
                        <th>Customer ID</th>
                        <th>Customer Name</th>
                        <th>Tel</th>
                        <th>Address</th>
                        <th>Postcode</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dinamik veri buraya gelir -->
                </tbody>
            </table>
            <button onclick="closeModal()">Kapat</button>
        </div>
    </div>

    <!-- Sabit Tab Bar - Sekme Ba≈ülƒ±klarƒ± altta -->
    <div class="tab-bar">
        <div class="tab active" onclick="openTab('tab_proforma')">Proforma</div>
        <div class="tab" onclick="openTab('tab_unite')">Unite</div>
        <div class="tab" onclick="openTab('tab_refrigeration')">Refrigeration</div>
        <div class="tab" onclick="openTab('tab_ceiling')">Ceiling</div>
        <div class="tab" onclick="openTab('tab_add_item')">Add Item</div>
        
        <div class="tab" onclick="openTab('tab_view_pdf')">View PDF</div>
        <div class="tab" onclick="openTab('tab_goruntule')">Goruntule</div>
    </div>

    <div id="queueContainer">
        <h3>ƒ∞≈ülem Kuyruƒüu</h3>
        <ul id="queueList"></ul>
    </div>

    <script>
        // Sekme a√ßma fonksiyonu
        function openTab(tabId) {
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[onclick="openTab('${tabId}')"]`).classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.trigger-select').forEach((select, index) => {
                select.addEventListener('change', function() {
                    toggleRowNumber(index);
                });
            });
    
            document.querySelectorAll('.bp-select').forEach((select, index) => {
                select.addEventListener('change', function() {
                    updateValueDisplay(index);
                });
            });
    
            document.querySelectorAll('.base-select').forEach((select, index) => {
                select.addEventListener('change', function() {
                    updateValueDisplay(index);
                });
            });
        });
    
        function toggleRowNumber(index) {
            const rowNumberCell = document.querySelectorAll('.row-number')[index];
            const triggerSelect = document.querySelectorAll('.trigger-select')[index];
            
            if (triggerSelect.value) {
                rowNumberCell.textContent = index + 1; 
            } else {
                rowNumberCell.textContent = ""; 
            }
        }
    
        function updateValueDisplay(index) {
        const bpSelect = document.querySelectorAll('.bp-select')[index];
        const type = document.querySelectorAll('.base-select')[index];
        const secondCombobox = document.querySelectorAll('.trigger-select')[index]; // 2. combobox
        const valueLabel1 = document.getElementById(`value1_${index}`);
        const valueLabel2 = document.getElementById(`value2_${index}`);
        const valueLabel3 = document.getElementById(`value3_${index}`);
        const valueLabel4 = document.getElementById(`value4_${index}`);

        const selectedValueBP = parseInt(bpSelect.value);
        const selectedValueBase = parseInt(type.value);
        const secondComboboxValue = secondCombobox.value; // 2. combobox deƒüeri alƒ±nƒ±yor
    
        let multiplier = 1;

    // 2. combobox deƒüeri 'Single Gondola' veya 'Double Gondola' ise multiplier 2 katƒ±na √ßƒ±kar
        if (secondComboboxValue === "Single Gondola" || secondComboboxValue === "Double Gondola") {
            if (!isNaN(selectedValueBase) && selectedValueBase > 10) {
                const adjustedValueBase = selectedValueBase - 10; 
                const pnl40=adjustedValueBase / 40
                valueLabel1.textContent = Math.floor(pnl40) * 2;
                const remainingAfter40 = adjustedValueBase - (Math.floor(pnl40) * 40); 
                const pnl30 = remainingAfter40 / 30; 
                valueLabel2.textContent = Math.floor(pnl30) * 2;
                const remainingAfter30 = remainingAfter40 - (Math.floor(pnl30) * 30); 
                const pnl20 = remainingAfter30 / 20; 
                valueLabel3.textContent = Math.floor(pnl20) * 2;
                const remainingAfter20 = remainingAfter30 - (Math.floor(pnl20) * 20); 
                const pnl10 = remainingAfter20 / 10; 
                valueLabel4.textContent = Math.floor(pnl10) * 2;
            }
            else {
            valueLabel1.textContent = "";
            valueLabel2.textContent = "";
            valueLabel3.textContent = "";
            valueLabel4.textContent = "";
            }  
        }
        else{

            if (!isNaN(selectedValueBase) && selectedValueBase > 10) {
                const adjustedValueBase = selectedValueBase - 10; 
                const pnl40=adjustedValueBase / 40
                valueLabel1.textContent = Math.floor(pnl40);
                const remainingAfter40 = adjustedValueBase - (Math.floor(pnl40) * 40); 
                const pnl30 = remainingAfter40 / 30; 
                valueLabel2.textContent = Math.floor(pnl30);
                const remainingAfter30 = remainingAfter40 - (Math.floor(pnl30) * 30); 
                const pnl20 = remainingAfter30 / 20; 
                valueLabel3.textContent = Math.floor(pnl20);
                const remainingAfter20 = remainingAfter30 - (Math.floor(pnl20) * 20); 
                const pnl10 = remainingAfter20 / 10; 
                valueLabel4.textContent = Math.floor(pnl10);
            }
            else {
            valueLabel1.textContent = "";
            valueLabel2.textContent = "";
            valueLabel3.textContent = "";
            valueLabel4.textContent = "";
            } 
        } 
    }       
        function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        // Rakam (0-9) ve Backspace (8) dƒ±≈üƒ±nda bir tu≈ü basƒ±ldƒ±ƒüƒ±nda engelle
        if (charCode != 8 && (charCode < 48 || charCode > 57)) {
            return false;
        }
        return true;
    }


let requestQueue = [];  // üîπ Kullanƒ±cƒ±larƒ± tutan kuyruk listesi
let processing = false; // üîπ ƒ∞≈ülem devam ediyor mu?

// üìå Kullanƒ±cƒ±yƒ± kuyruƒüa ekleyen ve sƒ±raya g√∂re √ßalƒ±≈ütƒ±ran fonksiyon
function queueManager(user) {
    if (requestQueue.includes(user)) {
        alert("Zaten kuyruƒüa eklenmi≈üsiniz! L√ºtfen bekleyin.");
        return;
    }

    requestQueue.push(user);
    updateQueueDisplay();

    if (!processing) {
        processNextInQueue();
    }
}

// üìå Kuyruktaki sƒ±radaki kullanƒ±cƒ±yƒ± se√ßen fonksiyon
function processNextInQueue() {
    if (requestQueue.length === 0) {
        processing = false;
        return;
    }

    processing = true;
    const currentUser = requestQueue.shift();  // üîπ ƒ∞lk kullanƒ±cƒ±yƒ± √ßƒ±kar
    updateQueueDisplay();

    console.log("‚úÖ ƒ∞≈ülem ba≈ülƒ±yor:", currentUser);

    // ‚úÖ **Sƒ±rasƒ± gelen kullanƒ±cƒ± `updateWidthData()` fonksiyonunu √ßalƒ±≈ütƒ±racak**
    updateWidthData(currentUser);
}

// üìå Kuyruktaki kullanƒ±cƒ±larƒ± HTML'e ekleyelim
function updateQueueDisplay() {
    const queueList = document.getElementById("queueList");
    queueList.innerHTML = "";

    requestQueue.forEach((user, index) => {
        const li = document.createElement("li");
        li.textContent = `${index + 1}. ${user}`;
        queueList.appendChild(li);
    });
}


// 1. ƒ∞lk fonksiyon: updateWidthData
//async function updateWidthData() {
async function updateWidthData(user = null) {
    const userElement = document.getElementById('username');

    if (!userElement) {
        console.error("‚ùå Hata: 'username' √∂ƒüesi bulunamadƒ±!");
        alert("Kullanƒ±cƒ± bilgisi alƒ±namadƒ±! L√ºtfen tekrar deneyin.");
        return;
    }

    const username = user ? user : userElement.textContent.trim().replace("User Name: ", ""); // üîπ Eƒüer kullanƒ±cƒ± yoksa HTML'den al
    console.log("üë§ ƒ∞≈ülem yapan kullanƒ±cƒ±:", username);

    const rows = Array.from(document.querySelectorAll('tbody tr'));
    let validRowFound = false;
    const errorMessages = [];
    const largestFile = document.getElementById('largestFile').textContent.trim();

    for (let index = 0; index < 40; index++) {
        const row = rows[index];
        const rowIndex = index + 1;

        // ƒ∞lgili select √∂ƒüelerinin varlƒ±ƒüƒ±nƒ± kontrol et
        const unitPieceElement = row.querySelector('select[name^="option1_"]');
        const unittypeElement = row.querySelector('select[name^="option2_"]');
        const heightValueElement = row.querySelector('select[name^="option3_"]');
        const widthValueElement = row.querySelector('select[name^="option4_"]');
        const baseShelfValueElement = row.querySelector('select[name^="option5_"]');
        const qtyValueElement = row.querySelector('select[name^="option6_"]');
        const shelfSizeValueElement = row.querySelector('select[name^="option7_"]');
        const qtyOption8Element = row.querySelector('select[name^="option8_"]');
        const shelfSizeOption9Element = row.querySelector('select[name^="option9_"]');
        const qtyOption10Element = row.querySelector('select[name^="option10_"]');
        const shelfSizeOption11Element = row.querySelector('select[name^="option11_"]');
        const plane40Element = row.querySelector('select[name^="option13_"]');
        const perf40Element = row.querySelector('select[name^="option14_"]');
        const plane30Element = row.querySelector('select[name^="option16_"]');
        const perf30Element = row.querySelector('select[name^="option17_"]');
        const plane20Element = row.querySelector('select[name^="option19_"]');
        const perf20Element = row.querySelector('select[name^="option20_"]');
        const plane10Element = row.querySelector('select[name^="option22_"]');
        const perf10Element = row.querySelector('select[name^="option23_"]');

        // Satƒ±rdaki deƒüerlerin herhangi biri se√ßilmi≈ü veya girilmi≈üse i≈ülem yap
        const anyValueEntered = 
            (unitPieceElement && unitPieceElement.value) ||
            (unittypeElement && unittypeElement.value) ||
            (heightValueElement && heightValueElement.value) ||
            (widthValueElement && widthValueElement.value) ||
            (baseShelfValueElement && baseShelfValueElement.value) ||
            (qtyValueElement && qtyValueElement.value) ||
            (shelfSizeValueElement && shelfSizeValueElement.value) ||
            (qtyOption8Element && qtyOption8Element.value) ||
            (shelfSizeOption9Element && shelfSizeOption9Element.value) ||
            (qtyOption10Element && qtyOption10Element.value) ||
            (shelfSizeOption11Element && shelfSizeOption11Element.value) ||
            (plane40Element && plane40Element.value) ||
            (perf40Element && perf40Element.value) ||
            (plane30Element && plane30Element.value) ||
            (perf30Element && perf30Element.value) ||
            (plane20Element && plane20Element.value) ||
            (perf20Element && perf20Element.value) ||
            (plane10Element && plane10Element.value) ||
            (perf10Element && perf10Element.value);

        // Eƒüer hi√ßbir deƒüer girilmediyse bu satƒ±rƒ± atla
        if (!anyValueEntered) {
            continue; // Bu satƒ±rƒ± atla ve sƒ±radaki satƒ±ra ge√ß
        }

        // Gerekli √∂ƒüeler eksikse hata mesajƒ± ekle ve bu satƒ±rƒ± atla
        if (!unitPieceElement || !unittypeElement || !heightValueElement || !widthValueElement || !baseShelfValueElement) {
            errorMessages.push(`Satƒ±r ${rowIndex}: Gerekli √∂ƒüeler eksik.`);
            continue; // Eksik √∂ƒüe varsa bu satƒ±rƒ± atla
        }

        // Se√ßilen deƒüerleri al
        const unitPiece = unitPieceElement.value;
        const unittype = unittypeElement.value;
        const heightValue = heightValueElement.value;
        const widthValue = widthValueElement.value;
        const baseShelfValue = baseShelfValueElement.value;
        const qtyValue = qtyValueElement ? qtyValueElement.value : '';
        const shelfSizeValue = shelfSizeValueElement ? shelfSizeValueElement.value : '';
        const qtyOption8 = qtyOption8Element ? qtyOption8Element.value : '';
        const shelfSizeOption9 = shelfSizeOption9Element ? shelfSizeOption9Element.value : '';
        const qtyOption10 = qtyOption10Element ? qtyOption10Element.value : '';
        const shelfSizeOption11 = shelfSizeOption11Element ? shelfSizeOption11Element.value : '';
        const plane40 = plane40Element ? plane40Element.value : '';
        const perf40 = perf40Element ? perf40Element.value : '';
        const plane30 = plane30Element ? plane30Element.value : '';
        const perf30 = perf30Element ? perf30Element.value : '';
        const plane20 = plane20Element ? plane20Element.value : '';
        const perf20 = perf20Element ? perf20Element.value : '';
        const plane10 = plane10Element ? plane10Element.value : '';
        const perf10 = perf10Element ? perf10Element.value : '';

        // Bo≈ü deƒüer kontrol√º
        const allOptionsEmpty =
            !unitPiece && !unittype && !heightValue && !widthValue && !baseShelfValue &&
            !qtyValue && !shelfSizeValue &&
            !qtyOption8 && !shelfSizeOption9 &&
            !qtyOption10 && !shelfSizeOption11 &&
            !plane40 && !perf40 &&
            !plane30 && !perf30 &&
            !plane20 && !perf20 &&
            !plane10 && !perf10;

        if (allOptionsEmpty) {
            continue; // Bu satƒ±rƒ± atla ve sƒ±radaki satƒ±ra ge√ß
        }
        else{
            //return;
        }

        validRowFound = true; // ƒ∞≈ülenecek bir satƒ±r bulundu

        // Fetch √ßaƒürƒ±sƒ±
        try {
            const response = await fetch('/update_width', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    row_index: rowIndex, // Satƒ±r numarasƒ±nƒ± ekliyoruz
                    unit_piece: unitPiece,
                    unit_type: unittype,
                    height: heightValue,
                    width: widthValue,
                    base_shelf: baseShelfValue,
                    qty: qtyValue,
                    shelf_size: shelfSizeValue,
                    qty_option8: qtyOption8,
                    shelf_size_option9: shelfSizeOption9,
                    qty_option10: qtyOption10,
                    shelf_size_option11: shelfSizeOption11,
                    plane40: plane40,
                    perf40: perf40,
                    plane30: plane30,
                    perf30: perf30,
                    plane20: plane20,
                    perf20: perf20,
                    plane10: plane10,
                    perf10: perf10,
                    largest_file: largestFile // largest_file deƒüerini de ekliyoruz
                }),
            });

            if (!response.ok) {
                throw new Error('G√ºncelleme sƒ±rasƒ±nda hata olu≈ütu.');
            }

            //loadQuoteList();
        } catch (error) {
            console.error('Hata:', error);
            document.getElementById('statusMessage').textContent = 'G√ºncelleme sƒ±rasƒ±nda hata olu≈ütu.';
            return false; // Eƒüer hata varsa i≈ülemi iptal et
        }
    }

    if (errorMessages.length > 0) {
        alert(errorMessages.join('\n'));
        return false; // Hatalar varsa false d√∂nd√ºr
    }

    if (!validRowFound) {
        alert('Unit bos');
        window.untknt = 0; // T√ºm fonksiyonlar i√ßin global bir deƒüi≈üken olu≈üturuyoruz.
        return true; // Hi√ßbir satƒ±r i≈ülenmediyse false d√∂nd√ºr
    }else{
        window.untknt = 1;
    }

    return true; // ƒ∞≈ülem ba≈üarƒ±yla tamamlandƒ±

        // ‚úÖ ƒ∞≈ülem bitince sƒ±radaki kullanƒ±cƒ±yƒ± ba≈ülat
        setTimeout(() => {
        console.log("‚úÖ ƒ∞≈ülem tamamlandƒ±:", username);
        processing = false;
        processNextInQueue();
    }, 3000); // 3 saniye i≈ülem s√ºresi sim√ºle edildi


}

// 2. ƒ∞kinci fonksiyon: showAddItemData
async function showAddItemData() {
    const rows = document.querySelectorAll('#tab_add_item tbody tr'); // T√ºm satƒ±rlarƒ± se√ß
    const largestFile = document.getElementById('largestFile').textContent.trim(); // largestFile deƒüerini al

    const addItemData = []; // G√∂nderilecek t√ºm verileri tutacak dizi

    // T√ºm satƒ±rlarda d√∂n
    rows.forEach((row) => {
        const inputs = row.querySelectorAll('input'); // Satƒ±rdaki t√ºm inputlarƒ± al
        const itemName = inputs[0]?.value.trim(); // 1. input (Item Name)
        const qty = inputs[1]?.value.trim(); // 2. input (Quantity)
        const price = inputs[2]?.value.trim(); // 3. input (Price)
        const dsprice = inputs[3]?.value.trim(); // 4. input (After Discount)
        const kar = inputs[4]?.value.trim(); // 5. input (Depo Code)

        // Eƒüer en az Item Name ve Quantity doluysa, veriyi ekle
        if (itemName && qty) {
            addItemData.push({
                itemName: itemName,
                qty: parseInt(qty, 10), // Sayƒ±ya √ßevir
                price: parseFloat(price || 0), // Sayƒ±ya √ßevir, bo≈üsa 0
                dsprice: parseFloat(dsprice || 0), // Sayƒ±ya √ßevir, bo≈üsa 0
                //kar: String(kar || "") // kar deƒüerini a√ßƒ±k√ßa text'e √ßevir
                kar:kar
            });
        }
    });

    // Eƒüer g√∂nderilecek veri yoksa uyarƒ± ver ve i≈ülemi durdur
     if (addItemData.length === 0) {
        ///////////////////////////////////////alert("Add item bos!");
        //return Promise.reject("Ge√ßerli veri yok.");
        window.aditmknt = 0; // T√ºm fonksiyonlar i√ßin global bir deƒüi≈üken olu≈üturuyoruz.
        return true;
    }else{
        window.aditmknt = 1;
    }

    // API'ye g√∂nderilecek veri
    const data = {
        add_item_data: addItemData, // Toplanan t√ºm satƒ±rlar
        largest_file: largestFile // largestFile deƒüeri burada kullanƒ±lƒ±yor
    };

    // API'ye POST isteƒüi g√∂nder
    try {
        // Yerel veya sunucu ortamƒ±na g√∂re API taban URL'sini ayarla
    const isLocal = window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost';

    const apiBaseUrl = isLocal
        ? 'http://127.0.0.1:5000' // Yerel geli≈ütirme ortamƒ± i√ßin
        : window.location.origin; // Render.com veya herhangi bir sunucu ortamƒ± i√ßin

    // API √ßaƒürƒ±sƒ±
    const response = await fetch(`${apiBaseUrl}/add_item_data`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
            },
        body: JSON.stringify(data)
    });


        const responseData = await response.json();

        if (responseData.status === "success") {
            alert("Veriler ba≈üarƒ±yla g√∂nderildi!");
        } else {
            throw new Error("Bir hata olu≈ütu: " + responseData.message);
        }
    } catch (error) {
        console.error('API Hatasƒ±:', error);
        alert('Veri g√∂nderme sƒ±rasƒ±nda hata olu≈ütu.');
        throw error; // Hata fƒ±rlatarak i≈ülemi durdur
    }
}
// 3. Main fonksiyon: Sƒ±ralƒ± √ßaƒüƒ±rma ve loadQuoteList() √ßaƒürƒ±sƒ±
async function mainFunction() {
    console.log("mainFunction √ßalƒ±≈ütƒ±");


    const nextNumber = await quotenumkont();
    if (!nextNumber) {
        console.error("quotenumkont i≈ülemi ba≈üarƒ±sƒ±z. ƒ∞≈ülem durduruldu.");
        return; // ƒ∞≈ülemi sonlandƒ±r
    }

    // largestFile deƒüerini g√ºncelle
    document.getElementById('largestFile').textContent = nextNumber


    // M√º≈üteri se√ßimi kontrol√º
    if (!selectedCustomerID) {
        alert("M√º≈üteri se√ßili deƒüil! L√ºtfen bir m√º≈üteri se√ßin.");
        return; // ƒ∞≈ülemleri sonlandƒ±r
    }

    // 1. updateWidthData √ßaƒürƒ±sƒ±
    const updateResult = await updateWidthData();

    if (!updateResult) {
        console.error('updateWidthData ba≈üarƒ±sƒ±z oldu. ƒ∞≈ülem sonlandƒ±rƒ±ldƒ±.');
        return;
    }

    // 2. showAddItemData √ßaƒürƒ±sƒ±
    try {
        console.log("showAddItemData fonksiyonu √ßaƒürƒ±ldƒ±.");
        await showAddItemData(); // ƒ∞≈ülemin tamamlanmasƒ±nƒ± bekle
    } catch (error) {
        console.error('showAddItemData ba≈üarƒ±sƒ±z oldu. ƒ∞≈ülem sonlandƒ±rƒ±ldƒ±.', error);
        return;
    }

    // 3. loadQuoteList √ßaƒürƒ±sƒ±
    if ((window.untknt || 0) + (window.aditmknt || 0) <= 0) {
        alert("Proforma olu≈üturulacak bir deƒüer yok!");
    } else {
        console.log("loadQuoteList fonksiyonu √ßaƒürƒ±lƒ±yor.");
        await loadQuoteList(); // ƒ∞≈ülemin tamamlanmasƒ±nƒ± bekle
    }
}



// 4. Event Listener
document.getElementById('updateWidthBtn').addEventListener('click', mainFunction);
//document.getElementById('updateWidthBtn').addEventListener('click', quotenumkont);

// Yeni fonksiyon: quotenumkont

async function quotenumkont() {
    try {
        // Sunucudan dosya listesini al
        const response = await fetch('/get_quote_files'); // quotes klas√∂r√ºndeki dosyalarƒ± d√∂nd√ºren bir endpoint
        if (!response.ok) {
            throw new Error('Dosya listesi alƒ±nƒ±rken hata olu≈ütu.');
        }

        // Dosya isimlerini al
        const files = await response.json(); // √ñrnek: ["001.db", "002.db", "010.db", "100.db"]
        if (!files || files.length === 0) {
            alert("Quotes klas√∂r√ºnde dosya bulunamadƒ±.");
            return null; // ƒ∞≈ülemi sonlandƒ±r
        }

        // Sadece .db uzantƒ±lƒ± dosyalarƒ± ve sƒ±fƒ±rlarƒ± koruyarak numaralarƒ± ayƒ±kla
        const fileNumbers = files
            .filter(file => file.endsWith('.db')) // .db uzantƒ±lƒ± dosyalarƒ± se√ß
            .map(file => file.match(/^(\d+)\.db$/)) // Numara kƒ±smƒ±nƒ± ve sƒ±fƒ±rlarƒ± ayƒ±kla
            .filter(match => match) // Ge√ßerli e≈üle≈ümeleri se√ß
            .map(match => match[1]); // Numara kƒ±smƒ±nƒ± al

        if (fileNumbers.length === 0) {
            alert("Ge√ßerli dosya numarasƒ± bulunamadƒ±.");
            return null; // ƒ∞≈ülemi sonlandƒ±r
        }

        // En b√ºy√ºk numarayƒ± bul
        const maxNumber = fileNumbers.reduce((max, num) => 
            num.length > max.length || (num.length === max.length && num > max) ? num : max
        );

        // Bir fazlasƒ±nƒ± hesapla, sƒ±fƒ±rlarƒ± koruyarak
        const nextNumber = (BigInt(maxNumber) + 1n).toString().padStart(maxNumber.length, '0');

        // Kullanƒ±cƒ±ya g√∂ster
        //////////////////////////////////////////alert(`Bir sonraki dosya numarasƒ±: ${nextNumber}`);

        return nextNumber; // Hesaplanan deƒüeri d√∂nd√ºr
    } catch (error) {
        console.error('Hata:', error);
        alert('Dosya kontrol√º sƒ±rasƒ±nda bir hata olu≈ütu.');
        return null; // ƒ∞≈ülemi sonlandƒ±r
    }
}





async function loadQuoteList() {
    const largestFile = document.getElementById('largestFile').textContent;
    const dbName = largestFile.replace('Quotation Number:', '').trim();

    try {
        const response = await fetch(`/get_quote_list?db_name=${dbName}`);

        if (!response.ok) {
            throw new Error('Veri alƒ±nƒ±rken hata olu≈ütu.');
        }

        const responseData = await response.json();
        const { db_name, data } = responseData;

        const tableHeader = document.getElementById('tableHeader');
        tableHeader.textContent = `Quote list: ${db_name}`;

        // Eƒüer data bo≈üsa tabloyu temizleyip mesaj g√∂ster
        if (!data || data.length === 0) {
            const tableBody = document.getElementById('quoteListTable').querySelector('tbody');
            tableBody.innerHTML = ''; // T√ºm veriyi temizle
            alert('G√∂sterilecek liste verisi bulunamadƒ±.');
            return;
        }

        // Sƒ±ralama ve tabloya yerle≈ütirme
        //data.sort((a, b) => a[3] - b[3]);

        const tableBody = document.getElementById('quoteListTable').querySelector('tbody');
        tableBody.innerHTML = '';

        data.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${row[0]}</td>
                <td>${row[1]}</td>
                <td>${row[2]}</td>
                <td>${row[3]}</td>
                <td>${row[4]}</td>
                <td>${row[5]}</td>
                <td>${row[6]}</td>
                <td>${row[7]}</td>
                <td>${row[8]}</td>
            `;
            tableBody.appendChild(tr);
        });
    } catch (error) {
        console.error('Hata:', error);
        document.getElementById('statusMessage').textContent = 'Liste y√ºklenirken hata olu≈ütu.';
    }
}

document.addEventListener('DOMContentLoaded', function () {
        // Hedef deƒüerler
        const targetValues = ["End / Wall Unit", "End / Single Gondola", "End / Double Gondola"];

        // T√ºm trigger-select sƒ±nƒ±fƒ±ndaki select elementlerini dinle
        const triggerSelects = document.querySelectorAll('.trigger-select');

        triggerSelects.forEach(select => {
            select.addEventListener('change', function () {
                const row = select.closest('tr'); // Satƒ±rƒ± bul
                const selectedValue = select.value; // Se√ßili deƒüeri al
                
                // Eƒüer se√ßili deƒüer hedef deƒüerlerden biriyse
                if (targetValues.includes(selectedValue)) {
                    lockComboboxes(row);
                } else {
                    unlockComboboxes(row);
                }
            });
        });

        // Combobox'larƒ± kilitle
        function lockComboboxes(row) {
            row.querySelectorAll('select').forEach((combobox, index) => {
                if (![0, 1, 2, 4, 22].includes(index)) { // 1., 2., 3., 5. ve 23. combobox'ƒ± atla
                    combobox.disabled = true;
                }
            });
        }

        // Combobox'larƒ± a√ß
        function unlockComboboxes(row) {
            row.querySelectorAll('select').forEach((combobox, index) => {
                if (![0, 1, 2, 4, 22].includes(index)) { // 1., 2., 3., 5. ve 23. combobox'ƒ± atla
                    combobox.disabled = false;
                }
            });
        }
    });

    document.addEventListener("DOMContentLoaded", function () {
        // Dinlenmesi gereken combobox isimlerini bir array olarak tanƒ±mlƒ±yoruz
        const monitoredComboboxes = [
            "option13_", "option14_", 
            "option16_", "option17_", 
            "option19_", "option20_", 
            "option22_", "option23_"
        ];

        // T√ºm satƒ±rlardaki comboboxlar i√ßin event listener ekle
        const selects = document.querySelectorAll("select");

        selects.forEach(select => {
            const name = select.getAttribute("name");
            if (monitoredComboboxes.some(prefix => name && name.startsWith(prefix))) {
                select.addEventListener("change", function () {
                    const row = select.closest('tr'); // ƒ∞lgili satƒ±rƒ± bul

                    // Her bir label i√ßin kontrol yap
                    checkLabelTotal(row, 'value1_', 'option13_', 'option14_');
                    checkLabelTotal(row, 'value2_', 'option16_', 'option17_');
                    checkLabelTotal(row, 'value3_', 'option19_', 'option20_');
                    checkLabelTotal(row, 'value4_', 'option22_', 'option23_');
                });
            }
        });

        // Label ile kendisinden sonraki iki combobox'ƒ± kontrol eden fonksiyon
        function checkLabelTotal(row, labelPrefix, combobox1Prefix, combobox2Prefix) {
            const rowIndex = row.dataset.rowIndex; // Satƒ±r index'i

            // Label ve ilgili combobox'larƒ± se√ß
            const label = row.querySelector(`#${labelPrefix}${rowIndex}`);
            const combobox1 = row.querySelector(`select[name="${combobox1Prefix}${rowIndex}"]`);
            const combobox2 = row.querySelector(`select[name="${combobox2Prefix}${rowIndex}"]`);

            if (label && combobox1 && combobox2) {
                const combobox1Value = parseFloat(combobox1.value) || 0;
                const combobox2Value = parseFloat(combobox2.value) || 0;
                const total = combobox1Value + combobox2Value;

                // Eƒüer label i√ßeriƒüi toplamƒ±na e≈üit deƒüilse kƒ±rmƒ±zƒ± arka plan ekle
                if (parseFloat(label.textContent) !== total) {
                    label.style.backgroundColor = "red";
                } else {
                    label.style.backgroundColor = ""; // Arka planƒ± temizle
                }
            }
        }
    });

    let selectedCustomerID = null;

// Modal a√ßma
function openModal() {
    selectedCustomerID = null; // Modal a√ßƒ±ldƒ±ƒüƒ±nda ID'yi sƒ±fƒ±rla
    document.getElementById("selectedCustomer").innerHTML = ""; // Se√ßilen m√º≈üteri bilgilerini temizle
    document.getElementById("customerModal").style.display = "flex";
    fetchCustomerData(); // Modal a√ßƒ±ldƒ±ƒüƒ±nda m√º≈üteri verilerini √ßek
}

// Modal kapama
function closeModal() {
    document.getElementById("customerModal").style.display = "none";
}

// M√º≈üteri verilerini √ßekme
function fetchCustomerData() {
    fetch("/fetch_customers")
        .then(response => response.json())
        .then(data => {
            const tableBody = document.getElementById("customerTable").querySelector("tbody");
            tableBody.innerHTML = ""; // Eski satƒ±rlarƒ± temizle
            data.forEach(customer => {
                const tr = document.createElement("tr");
                customer.forEach(cell => {
                    const td = document.createElement("td");
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                tr.addEventListener("dblclick", () => selectCustomer(customer)); // Satƒ±rƒ± tƒ±klanabilir hale getir
                tableBody.appendChild(tr);
            });
        });
}

// M√º≈üteri se√ßme
function selectCustomer(customer) {
    // Global deƒüi≈ükene m√º≈üteri ID'sini ata
    selectedCustomerID = customer[0];

    // Se√ßilen m√º≈üteri bilgilerini ekrana yaz
    document.getElementById("selectedCustomer").innerHTML = `
        <strong>Customer Name:</strong> ${customer[1]} <br>
        <strong>Tel:</strong> ${customer[2]} <br>
        <strong>Address:</strong> ${customer[3]} <br>
        <strong>Postcode:</strong> ${customer[4]}
    `;

    // Modal'ƒ± kapat
    closeModal();
}

// Arama fonksiyonu
function searchCustomer() {
    const input = document.getElementById("searchBox").value.toUpperCase();
    const table = document.getElementById("customerTable");
    const tr = table.getElementsByTagName("tr");

    for (let i = 1; i < tr.length; i++) { // ƒ∞lk satƒ±r ba≈ülƒ±k olduƒüu i√ßin 1'den ba≈üla
        const tds = tr[i].getElementsByTagName("td");
        let visible = false;
        for (let td of tds) {
            if (td.textContent.toUpperCase().includes(input)) {
                visible = true;
                break;
            }
        }
        tr[i].style.display = visible ? "" : "none";
    }
}


function getUserName() {
    const userElement = document.getElementById('username');
    if (!userElement) {
        console.error("‚ùå Hata: Kullanƒ±cƒ± adƒ± bulunamadƒ±!");
        alert("Kullanƒ±cƒ± adƒ± bulunamadƒ±! L√ºtfen tekrar deneyin.");
        return "";
    }
    return userElement.textContent.trim().replace("User Name: ", "");  
}

    </script>

</body>
</html>
